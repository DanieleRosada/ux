{"version":3,"file":"index.js","sources":["../../src/ux-textarea.ts","../../src/ux-textarea-theme.ts","../../src/index.ts"],"sourcesContent":["import { customElement, bindable, inlineView } from 'aurelia-templating';\nimport { DOM } from 'aurelia-pal';\nimport { inject } from 'aurelia-dependency-injection';\nimport { StyleEngine, UxComponent } from '@aurelia-ux/core';\nimport { UxTextAreaTheme } from './ux-textarea-theme';\nimport { observable } from 'aurelia-framework';\nimport * as VIEW from './ux-textarea.html';\n\nexport interface UxTextAreaElement extends HTMLElement {\n  value: string;\n}\n\n@inject(Element, StyleEngine)\n@customElement('ux-textarea')\n@inlineView(VIEW)\nexport class UxTextArea implements UxComponent {\n  private ignoreRawChanges: boolean;\n  private isAttached: boolean;\n\n  @bindable public autocomplete: string;\n  @bindable public autofocus: boolean | string | null = null;\n  @bindable public autoResize: boolean | string = false;\n  @bindable public cols: number;\n  @bindable public disabled: boolean | string = false;\n  @bindable public focus: boolean | string = false;\n  @bindable public maxlength: number;\n  @bindable public minlength: number;\n  @bindable public readonly: boolean | string = false;\n  @bindable public rows: number;\n  @bindable public theme: UxTextAreaTheme;\n\n  @observable({ initializer: () => '' })\n  public rawValue: string;\n\n  public value: any = undefined;\n\n  public textbox: HTMLTextAreaElement;\n\n  constructor(private element: UxTextAreaElement, private styleEngine: StyleEngine) {\n    Object.setPrototypeOf(element, uxTextAreaElementProto);\n  }\n\n  public bind() {\n\n    const element = this.element;\n    const textbox = this.textbox;\n\n    if (this.autofocus || this.autofocus === '') {\n      this.focus = true;\n    }\n\n    if (element.hasAttribute('placeholder')) {\n      const attributeValue = element.getAttribute('placeholder');\n\n      if (attributeValue) {\n        textbox.setAttribute('placeholder', attributeValue);\n        element.removeAttribute('placeholder');\n      }\n    }\n\n    if (this.cols) {\n      textbox.setAttribute('cols', this.cols.toString());\n      element.removeAttribute('cols');\n    }\n\n    if (this.rows) {\n      textbox.setAttribute('rows', this.rows.toString());\n      element.removeAttribute('rows');\n    }\n\n    if (this.minlength) {\n      textbox.setAttribute('minlength', this.minlength.toString());\n    }\n\n    if (this.maxlength) {\n      textbox.setAttribute('maxlength', this.maxlength.toString());\n    }\n\n    this.autocompleteChanged(this.autocomplete);\n  }\n\n  public attached() {\n    const textbox = this.textbox;\n    this.isAttached = true;\n    this.textbox.addEventListener('change', stopEvent);\n    this.textbox.addEventListener('input', stopEvent);\n    this.fitTextContent();\n\n    textbox.addEventListener('change', stopEvent);\n    textbox.addEventListener('input', stopEvent);\n  }\n\n  public detached() {\n    const textbox = this.textbox;\n    this.isAttached = false;\n\n    textbox.removeEventListener('change', stopEvent);\n    textbox.removeEventListener('input', stopEvent);\n  }\n\n  public getValue() {\n    return this.value;\n  }\n\n  public setValue(value: any) {\n    const oldValue = this.value;\n    const newValue = value === null || value === undefined ? null : value.toString();\n\n    if (oldValue !== newValue) {\n      this.value = newValue;\n      this.ignoreRawChanges = true;\n      this.rawValue = newValue === null ? '' : newValue.toString();\n      this.fitTextContent();\n      this.ignoreRawChanges = false;\n      this.element.dispatchEvent(DOM.createCustomEvent('change', { bubbles: true }));\n    }\n  }\n\n  public autocompleteChanged(newValue: any) {\n    if (newValue != null) {\n      this.textbox.setAttribute('autocomplete', newValue);\n    } else {\n      this.textbox.removeAttribute('autocomplete');\n    }\n  }\n\n  public rawValueChanged(rawValue: string) {\n    if (this.ignoreRawChanges) {\n      return;\n    }\n    this.setValue(rawValue);\n  }\n\n  public themeChanged(newValue: any) {\n    if (newValue != null && newValue.themeKey == null) {\n      newValue.themeKey = 'textarea';\n    }\n\n    this.styleEngine.applyTheme(newValue, this.element);\n  }\n\n  public fitTextContent() {\n    if (this.isAttached && (this.autoResize || this.autoResize === '')) {\n      this.textbox.style.height = 'auto';\n      this.textbox.style.height = `${this.textbox.scrollHeight + 2}px`;\n    }\n  }\n\n  public focusChanged(focus: boolean | string) {\n    focus = focus || focus === '' ? true : false;\n    this.element.dispatchEvent(DOM.createCustomEvent(focus ? 'focus' : 'blur', { bubbles: true }));\n  }\n}\n\nfunction stopEvent(e: Event) {\n  e.stopPropagation();\n}\n\nconst getVm = <T>(_: any) => _.au.controller.viewModel as T;\nconst uxTextAreaElementProto = Object.create(HTMLElement.prototype, {\n  value: {\n    get() {\n      return getVm<UxTextArea>(this).getValue();\n    },\n    set(value: any) {\n      getVm<UxTextArea>(this).setValue(value);\n    }\n  }\n});\n","import { UxTheme } from '@aurelia-ux/core';\n\nexport class UxTextAreaTheme implements UxTheme {\n  public themeKey = 'textarea';\n\n  public foreground: string;\n  public background: string;\n\n  public borderBottom: string;\n  public borderBottomHover: string;\n  public borderBottomSelected: string;\n\n  public diabledForeground: string;\n  public disabledBorderBottom: string;\n\n  public fullWidthBorder: string;\n  public fullWidthForeground: string;\n  public fullWidthBackground: string;\n  public fullWidthBackgroundDisabled: string;\n\n  public error: string;\n}\n","/// <reference path=\"html.d.ts\" />\nimport { FrameworkConfiguration, bindingMode } from 'aurelia-framework';\nimport { ValueAttributeObserver, EventSubscriber } from 'aurelia-binding';\nimport { AureliaUX } from '@aurelia-ux/core';\nimport { UxTextArea } from './ux-textarea';\n\nexport { UxTextAreaTheme } from './ux-textarea-theme';\nexport { UxTextArea, UxTextAreaElement } from './ux-textarea';\n\nexport function configure(config: FrameworkConfiguration) {\n  config.container.get(AureliaUX).registerUxElementConfig(uxTextAreaConfig);\n  config.globalResources(UxTextArea);\n}\n\nconst uxTextAreaConfig = {\n  tagName: 'ux-textarea',\n  properties: {\n    value: {\n      defaultBindingMode: bindingMode.twoWay,\n      getObserver(element: Element) {\n        return new ValueAttributeObserver(element, 'value', new EventSubscriber(['change']));\n      }\n    }\n  }\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAsCE,oBAAoB,OAA0B,EAAU,WAAwB;QAA5D,YAAO,GAAP,OAAO,CAAmB;QAAU,gBAAW,GAAX,WAAW,CAAa;QAlB/D,cAAS,GAA4B,IAAI,CAAC;QAC1C,eAAU,GAAqB,KAAK,CAAC;QAErC,aAAQ,GAAqB,KAAK,CAAC;QACnC,UAAK,GAAqB,KAAK,CAAC;QAGhC,aAAQ,GAAqB,KAAK,CAAC;QAO7C,UAAK,GAAQ,SAAS,CAAC;QAK5B,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,sBAAsB,CAAC,CAAC;KACxD;IAEM,yBAAI,GAAX;QAEE,IAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,IAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAE7B,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,KAAK,EAAE,EAAE;YAC3C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;SACnB;QAED,IAAI,OAAO,CAAC,YAAY,CAAC,aAAa,CAAC,EAAE;YACvC,IAAM,cAAc,GAAG,OAAO,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;YAE3D,IAAI,cAAc,EAAE;gBAClB,OAAO,CAAC,YAAY,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;gBACpD,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;aACxC;SACF;QAED,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,OAAO,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YACnD,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;SACjC;QAED,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,OAAO,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YACnD,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;SACjC;QAED,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,OAAO,CAAC,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;SAC9D;QAED,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,OAAO,CAAC,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;SAC9D;QAED,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KAC7C;IAEM,6BAAQ,GAAf;QACE,IAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QACnD,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QAClD,IAAI,CAAC,cAAc,EAAE,CAAC;QAEtB,OAAO,CAAC,gBAAgB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC9C,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;KAC9C;IAEM,6BAAQ,GAAf;QACE,IAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAExB,OAAO,CAAC,mBAAmB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QACjD,OAAO,CAAC,mBAAmB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;KACjD;IAEM,6BAAQ,GAAf;QACE,OAAO,IAAI,CAAC,KAAK,CAAC;KACnB;IAEM,6BAAQ,GAAf,UAAgB,KAAU;QACxB,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;QAC5B,IAAM,QAAQ,GAAG,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,SAAS,GAAG,IAAI,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;QAEjF,IAAI,QAAQ,KAAK,QAAQ,EAAE;YACzB,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;YACtB,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;YAC7B,IAAI,CAAC,QAAQ,GAAG,QAAQ,KAAK,IAAI,GAAG,EAAE,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC;YAC7D,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAC;YAC9B,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,iBAAiB,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;SAChF;KACF;IAEM,wCAAmB,GAA1B,UAA2B,QAAa;QACtC,IAAI,QAAQ,IAAI,IAAI,EAAE;YACpB,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;SACrD;aAAM;YACL,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;SAC9C;KACF;IAEM,oCAAe,GAAtB,UAAuB,QAAgB;QACrC,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,OAAO;SACR;QACD,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;KACzB;IAEM,iCAAY,GAAnB,UAAoB,QAAa;QAC/B,IAAI,QAAQ,IAAI,IAAI,IAAI,QAAQ,CAAC,QAAQ,IAAI,IAAI,EAAE;YACjD,QAAQ,CAAC,QAAQ,GAAG,UAAU,CAAC;SAChC;QAED,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;KACrD;IAEM,mCAAc,GAArB;QACE,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,KAAK,EAAE,CAAC,EAAE;YAClE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;YACnC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAM,IAAI,CAAC,OAAO,CAAC,YAAY,GAAG,CAAC,OAAI,CAAC;SAClE;KACF;IAEM,iCAAY,GAAnB,UAAoB,KAAuB;QACzC,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,EAAE,GAAG,IAAI,GAAG,KAAK,CAAC;QAC7C,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,iBAAiB,CAAC,KAAK,GAAG,OAAO,GAAG,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;KAChG;IApIS;QAAT,QAAQ;oDAA6B;IAC5B;QAAT,QAAQ;iDAAkD;IACjD;QAAT,QAAQ;kDAA6C;IAC5C;QAAT,QAAQ;4CAAqB;IACpB;QAAT,QAAQ;gDAA2C;IAC1C;QAAT,QAAQ;6CAAwC;IACvC;QAAT,QAAQ;iDAA0B;IACzB;QAAT,QAAQ;iDAA0B;IACzB;QAAT,QAAQ;gDAA2C;IAC1C;QAAT,QAAQ;4CAAqB;IACpB;QAAT,QAAQ;6CAA+B;IAGxC;QADC,UAAU,CAAC,EAAE,WAAW,EAAE,cAAM,OAAA,EAAE,GAAA,EAAE,CAAC;gDACd;IAjBb,UAAU;QAHtB,MAAM,CAAC,OAAO,EAAE,WAAW,CAAC;QAC5B,aAAa,CAAC,aAAa,CAAC;QAC5B,UAAU,CAAC,IAAI,CAAC;OACJ,UAAU,CAyItB;IAAD,iBAAC;CAzID,IAyIC;AAED,SAAS,SAAS,CAAC,CAAQ;IACzB,CAAC,CAAC,eAAe,EAAE,CAAC;CACrB;AAED,IAAM,KAAK,GAAG,UAAI,CAAM,IAAK,OAAA,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,SAAc,GAAA,CAAC;AAC5D,IAAM,sBAAsB,GAAG,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE;IAClE,KAAK,EAAE;QACL,GAAG,EAAH;YACE,OAAO,KAAK,CAAa,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;SAC3C;QACD,GAAG,EAAH,UAAI,KAAU;YACZ,KAAK,CAAa,IAAI,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;SACzC;KACF;CACF,CAAC,CAAC;;;ICtKH;QACS,aAAQ,GAAG,UAAU,CAAC;KAkB9B;IAAD,sBAAC;CAAA;;ACrBD;AACA,SAQgB,SAAS,CAAC,MAA8B;IACtD,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,uBAAuB,CAAC,gBAAgB,CAAC,CAAC;IAC1E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;CACpC;AAED,IAAM,gBAAgB,GAAG;IACvB,OAAO,EAAE,aAAa;IACtB,UAAU,EAAE;QACV,KAAK,EAAE;YACL,kBAAkB,EAAE,WAAW,CAAC,MAAM;YACtC,WAAW,EAAX,UAAY,OAAgB;gBAC1B,OAAO,IAAI,sBAAsB,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,eAAe,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;aACtF;SACF;KACF;CACF,CAAC;;;;"}